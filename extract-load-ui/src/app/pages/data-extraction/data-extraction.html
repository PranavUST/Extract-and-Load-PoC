<div style="display: flex; justify-content: flex-start; margin-bottom: 16px;">
  <button mat-icon-button color="primary" [routerLink]="['/landing']" aria-label="Home">
    <mat-icon>home</mat-icon>
  </button>
</div>

<mat-tab-group>
  <mat-tab label="Source Config">
    <div style="max-height: 70vh; overflow-y: auto; padding-right: 8px;">
      <app-source-config (configSaved)="refreshConfigs()"></app-source-config>
    </div>
  </mat-tab>
  <mat-tab label="Target Config">
    <div style="max-height: 70vh; overflow-y: auto; padding-right: 8px;">
      <app-target-config (configSaved)="refreshConfigs()"></app-target-config>
    </div>
  </mat-tab>
  <mat-tab label="Schedule">
    <div style="max-height: 70vh; overflow-y: auto; padding-right: 8px;">
      <mat-card style="margin-top: 24px;">
        <mat-card-title>Schedule Pipeline Run</mat-card-title>
        <form [formGroup]="schedulerForm" (ngSubmit)="runPipeline()">
          <div style="display: flex; gap: 16px; flex-wrap: wrap;">
            <mat-form-field appearance="fill">
              <mat-label>Interval (minutes)</mat-label>
              <input matInput type="number" formControlName="interval" min="1" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Duration (hours)</mat-label>
              <input matInput type="number" formControlName="duration" min="0.1" step="0.1" required>
            </mat-form-field>
            <button mat-raised-button color="primary" type="submit" [disabled]="schedulerForm.invalid">
              Run Pipeline (Schedule)
            </button>
            <button mat-raised-button color="accent" type="button" (click)="runPipelineOnce()">
              Run Once
            </button>
          </div>
        </form>
        <div *ngIf="status" class="status-message" style="margin-top:1rem;">
          {{ status }}
        </div>
        <div>Log count: {{ statusDetails.length }}</div>
        <div *ngIf="statusDetails.length" style="margin-top: 1rem; background: #f5f5f5; border: 1px solid #ccc; padding: 8px;">
          <strong>Pipeline Details:</strong>
          <ul>
            <li *ngFor="let s of statusDetails">
              <span style="color:gray">{{ s.timestamp }}:</span> {{ s.message }}
            </li>
          </ul>
        </div>
        <div>Current runId: {{ runId }}</div>
        <div *ngIf="waitingForScheduledRun" style="color: #888; margin-top: 1rem;">
          Waiting for next scheduled run to start...
        </div>
        <button mat-raised-button color="warn" type="button" (click)="stopPipeline()" style="margin-top: 1rem;">
          Stop Pipeline
        </button>
      </mat-card>
    </div>
  </mat-tab>
  <mat-tab label="Saved Configs">
    <div style="max-height: 70vh; overflow-y: auto; padding-right: 8px;">
      <app-config-list></app-config-list>
    </div>
  </mat-tab>
</mat-tab-group>